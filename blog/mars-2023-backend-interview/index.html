<!doctype html>
<html lang="zh-Hans">
  <head>
    <meta charset="utf-8" />
    <meta name="description" content="Mars工作室主页" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" href="../../favicon.ico" />
    <link rel="alternate" type="application/atom+xml" href="/rss.xml" />
    <script type="module" src="/assets/js/theme.js"></script>
    
		<link href="../../_app/immutable/assets/0.111c6e36.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/IconBase.6bf551a2.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/5.3f933b35.css" rel="stylesheet">
		<link rel="modulepreload" href="../../_app/immutable/entry/start.e4cd780c.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/scheduler.8159148a.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/singletons.d82710ea.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/index.5c957cd0.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/control.f5b05b5f.js">
		<link rel="modulepreload" href="../../_app/immutable/entry/app.cd087bc5.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/preload-helper.a4192956.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/index.4ec63fb7.js">
		<link rel="modulepreload" href="../../_app/immutable/nodes/0.ce50d776.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/IconBase.2a01f74c.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/stores.3ab7875d.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/index.ce2aa884.js">
		<link rel="modulepreload" href="../../_app/immutable/nodes/5.8c553a64.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/FaRegCalendarAlt.f29ac41a.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/index.ced1acf2.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/timeInterval.508b7975.js"><title>Mars工作室 • 文章动态</title><!-- HEAD_svelte-yqwjf1_START --><meta property="og:title" content="Mars工作室2023后端面试题" class="svelte-45li5a"><!-- HEAD_svelte-yqwjf1_END -->
  </head>
  <body data-sveltekit-preload-data="tap">
    <div id="app">  <nav class="px-4 md:px-28 pt-5 w-full flex flex-row items-center justify-between"><a href="/" class="z-20 flex flex-row items-center gap-1.5" data-svelte-h="svelte-x7n5al"><div class="title svelte-2pdfsi">Mars工作室</div> </a> <div class="flex flex-row items-center gap-3 md:gap-5"><ul class="hidden md:flex flex-row gap-4 text-lg"> <li><a href="/" class="link svelte-ep9j7n">首页</a> </li> <li><a href="/mirrors" class="link svelte-ep9j7n">镜像站</a> </li> <li><a href="/links" class="link svelte-ep9j7n">资源推荐</a> </li> <li><a href="/blog" class="link svelte-ep9j7n active">文章动态</a> </li> </ul> <button title="主题" type="button" class="z-20 relative w-6 h-6"><div class="theme-icon svelte-seqoda"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="svelte-c8tyih"><path d="M10 2c-1.82 0-3.53.5-5 1.35C7.99 5.08 10 8.3 10 12s-2.01 6.92-5 8.65C6.47 21.5 8.18 22 10 22c5.52 0 10-4.48 10-10S15.52 2 10 2z"></path></svg></div> <div class="theme-icon svelte-seqoda active"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="svelte-c8tyih"><path d="M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69zM12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6c3.31 0 6 2.69 6 6s-2.69 6-6 6z"></path></svg></div> </button> <div class="md:hidden flex items-center justify-center svelte-vykp5p"><button type="button" title="菜单" aria-label="菜单" class="menu-btn svelte-vykp5p"><div class="menu-icon svelte-vykp5p"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="svelte-c8tyih"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg></div> <div class="menu-icon svelte-vykp5p active"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="svelte-c8tyih"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg></div></button> <ul class="menu svelte-vykp5p"> <li class="svelte-vykp5p"><a href="/" class="link svelte-vykp5p">首页</a> </li> <li class="svelte-vykp5p"><a href="/mirrors" class="link svelte-vykp5p">镜像站</a> </li> <li class="svelte-vykp5p"><a href="/links" class="link svelte-vykp5p">资源推荐</a> </li> <li class="svelte-vykp5p"><a href="/blog" class="link svelte-vykp5p active">文章动态</a> </li></ul> </div></div></nav>  <main class="w-full flex-1 frame py-10 flex flex-col gap-5 animate-slideFromBottom svelte-45li5a"><header class="flex flex-col gap-0.5 md:gap-2 pl-2"><h1 class="text-2xl md:text-3xl font-semibold">Mars工作室2023后端面试题</h1> <div class="flex flex-row items-center flex-wrap gap-2 text-gray-500 dark:text-gray-300 text-sm"><div class="flex flex-row items-center gap-0.5"><div class="w-3 h-3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="svelte-c8tyih"><path d="M148 288h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h48c26.5 0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z"></path></svg></div> <div title="2023-09-25 18:40:22">发布于11个月前</div> <div title="2023-09-25 18:40:22">(更新于11个月前)</div></div> <div class="flex flex-row items-center gap-0.5"><div class="w-3 h-3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="svelte-c8tyih"><path d="M313.6 304c-28.7 0-42.5 16-89.6 16-47.1 0-60.8-16-89.6-16C60.2 304 0 364.2 0 438.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-25.6c0-74.2-60.2-134.4-134.4-134.4zM400 464H48v-25.6c0-47.6 38.8-86.4 86.4-86.4 14.6 0 38.3 16 89.6 16 51.7 0 74.9-16 89.6-16 47.6 0 86.4 38.8 86.4 86.4V464zM224 288c79.5 0 144-64.5 144-144S303.5 0 224 0 80 64.5 80 144s64.5 144 144 144zm0-240c52.9 0 96 43.1 96 96s-43.1 96-96 96-96-43.1-96-96 43.1-96 96-96z"></path></svg></div> <div>李志嘉撰写</div></div></div></header> <article class="markdown svelte-45li5a"><div class="w-full flex flex-col gap-5 svelte-45li5a"><div class="content svelte-45li5a"><nav class="toc hidden" data-svelte-h="svelte-1ev0mlb"><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#一题目">一、题目</a></li><li class="toc-item toc-item-h1"><a class="toc-link toc-link-h1" href="#二参考代码golang实现">二、参考代码(Golang实现)</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#1-代码">1. 代码</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#2-运行">2. 运行</a></li></ol></li></ol></nav> <p data-svelte-h="svelte-1e4djzc"><strong>60</strong>分钟。不限开发环境，不限编程语言及生态，不允许使用AI工具直接生成代码。</p> <h1 id="一题目" data-svelte-h="svelte-rf154v"><a href="#一题目">一、题目</a></h1> <blockquote data-svelte-h="svelte-tsefzc"><p>漂流瓶，也称为浮标，是一种在海洋中漂流的瓶子，用于研究海洋洋流和浪漫目的。</p> <p>公元前310年，希腊哲学家提奥弗拉斯托斯试图通过放置一些漂流瓶并等待它们的回归来证明地中海是由大西洋洋流形成的，不过它们最终并没有回来。在16世纪期间，英国海军通过发送加密的瓶中信件与伊丽莎白女王一世进行通信。这些漂流密码具有极高的战略价值，以至于女王任命了一位官方的“海洋瓶子开启者”——任何其他人敢于打开它们都将面临死刑。</p> <p>1914年6月，格拉斯哥航海学校的C·亨特·布朗船长放置了近2000个编号的瓶子。找到瓶子的人被要求在最近的邮局投下一张说明其位置的便条。说明中解释道：“我们的目标是找出北海深层洋流的方向”。其中一个在2012年被发现，成为世界上最古老的漂流瓶中信。</p></blockquote> <p data-svelte-h="svelte-1s8njg5">现在，让我们来尝试模拟使用漂流瓶传递信息，请编写一个程序，监听<code>7000</code>端口，并通过 <code>HTTP</code> 协议实现如下功能，你可以自行设计API风格:</p> <ul data-svelte-h="svelte-v1itvy"><li><p>不需要任何用户认证和鉴权系统，所有操作完全匿名，如果需要，可以下发临时的认证token。</p></li> <li><p>用户可以创建一个”瓶子”并附上信息，然后”抛入海洋”，随后将有可能被其它用户收到。</p></li> <li><p>用户可以尝试获取一个瓶子，并查看其中信息，随后，用户可以做三个操作：</p> <ul><li>保留该瓶子，后续不会继续被其它用户收到，签发给用户一个安全的token以便以后用户查询该瓶子。</li> <li>将该瓶子扔回”海洋”，该瓶子会继续漂流并有可能被更多用户收到。</li> <li>在瓶子中额外加入一段信息，然后扔回”海洋”，该瓶子会继续漂流并有可能被更多用户收到，下一个收到瓶子的用户将能看到附加的信息。</li> <li>但是，如果用户在30分钟后没有执行任何操作，则删除该瓶子，同时用户也无法再次访问该瓶子。</li></ul></li> <li><p>额外功能(可选，加分项):</p> <ul><li>有 OpenAPI 文档，内建 Swagger UI 支持。</li> <li>采用<code>docker</code>打包，并提供<code>Dockerfile</code></li></ul></li></ul> <h1 id="二参考代码golang实现" data-svelte-h="svelte-1obfos7"><a href="#二参考代码golang实现">二、参考代码(Golang实现)</a></h1> <p data-svelte-h="svelte-y8d49u">模块名为<code>git.online.njtech.edu.cn/online/backend_itv_2023_go</code></p> <h2 id="1-代码" data-svelte-h="svelte-44mpuj"><a href="#1-代码">1. 代码</a></h2> <p data-svelte-h="svelte-1akt3u1"><strong>data.go</strong></p> <pre class="language-go"><!-- HTML_TAG_START --><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"gorm.io/gorm"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Bottle <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
	gorm<span class="token punctuation">.</span>Model
	Content     <span class="token builtin">string</span>
	Owner       <span class="token builtin">string</span>
	Attachments <span class="token punctuation">[</span><span class="token punctuation">]</span>Attachment
<span class="token punctuation">&#125;</span>

<span class="token keyword">type</span> Attachment <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
	gorm<span class="token punctuation">.</span>Model
	BottleID <span class="token builtin">uint</span>
	Content  <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">type</span> BottleRepo <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
	db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>BottleRepo<span class="token punctuation">)</span> <span class="token function">Create</span><span class="token punctuation">(</span>bottle <span class="token operator">*</span>Bottle<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> r<span class="token punctuation">.</span>db<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>bottle<span class="token punctuation">)</span><span class="token punctuation">.</span>Error
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>BottleRepo<span class="token punctuation">)</span> <span class="token function">GetById</span><span class="token punctuation">(</span>id <span class="token builtin">uint</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>Bottle<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">var</span> bottle Bottle
	err <span class="token operator">:=</span> r<span class="token punctuation">.</span>db<span class="token punctuation">.</span><span class="token function">Preload</span><span class="token punctuation">(</span><span class="token string">"Attachments"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>bottle<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span>Error
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>bottle<span class="token punctuation">,</span> err
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>r BottleRepo<span class="token punctuation">)</span> <span class="token function">GetByRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>Bottle<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">var</span> bottle Bottle
	err <span class="token operator">:=</span> r<span class="token punctuation">.</span>db<span class="token punctuation">.</span><span class="token function">Preload</span><span class="token punctuation">(</span><span class="token string">"Attachments"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">"owner == ''"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Order</span><span class="token punctuation">(</span><span class="token string">"RANDOM()"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>bottle<span class="token punctuation">)</span><span class="token punctuation">.</span>Error
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>bottle<span class="token punctuation">,</span> err
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>BottleRepo<span class="token punctuation">)</span> <span class="token function">Delete</span><span class="token punctuation">(</span>id <span class="token builtin">uint</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">&#123;</span>
	<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">GetById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> err
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">return</span> r<span class="token punctuation">.</span>db<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Bottle<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span>Error
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>BottleRepo<span class="token punctuation">)</span> <span class="token function">AttachMessage</span><span class="token punctuation">(</span>id <span class="token builtin">uint</span><span class="token punctuation">,</span> content <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">&#123;</span>
	bottle<span class="token punctuation">,</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">GetById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> err
	<span class="token punctuation">&#125;</span>
	attachment <span class="token operator">:=</span> Attachment<span class="token punctuation">&#123;</span>BottleID<span class="token punctuation">:</span> bottle<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> Content<span class="token punctuation">:</span> content<span class="token punctuation">&#125;</span>
	<span class="token keyword">return</span> r<span class="token punctuation">.</span>db<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attachment<span class="token punctuation">)</span><span class="token punctuation">.</span>Error
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>BottleRepo<span class="token punctuation">)</span> <span class="token function">SetOwner</span><span class="token punctuation">(</span>id <span class="token builtin">uint</span><span class="token punctuation">,</span> owner <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">&#123;</span>
	bottle<span class="token punctuation">,</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">GetById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> err
	<span class="token punctuation">&#125;</span>
	bottle<span class="token punctuation">.</span>Owner <span class="token operator">=</span> owner
	<span class="token keyword">return</span> r<span class="token punctuation">.</span>db<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span>bottle<span class="token punctuation">)</span><span class="token punctuation">.</span>Error
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">NewBottleRepo</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token operator">*</span>BottleRepo <span class="token punctuation">&#123;</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Bottle<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>Attachment<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>BottleRepo<span class="token punctuation">&#123;</span>db<span class="token punctuation">:</span> db<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre> <p data-svelte-h="svelte-hl22om"><strong>service.go</strong></p> <pre class="language-go"><!-- HTML_TAG_START --><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"crypto/hmac"</span>
	<span class="token string">"crypto/rand"</span>
	<span class="token string">"crypto/sha256"</span>
	<span class="token string">"encoding/base64"</span>
	<span class="token string">"encoding/json"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> BottleService <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
	repo <span class="token operator">*</span>BottleRepo
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">NewBottleService</span><span class="token punctuation">(</span>repo <span class="token operator">*</span>BottleRepo<span class="token punctuation">)</span> <span class="token operator">*</span>BottleService <span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>BottleService<span class="token punctuation">&#123;</span>repo<span class="token punctuation">:</span> repo<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>BottleService<span class="token punctuation">)</span> <span class="token function">Create</span><span class="token punctuation">(</span>bottle <span class="token operator">*</span>Bottle<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> s<span class="token punctuation">.</span>repo<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>bottle<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>BottleService<span class="token punctuation">)</span> <span class="token function">GetBottle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>Bottle<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> s<span class="token punctuation">.</span>repo<span class="token punctuation">.</span><span class="token function">GetByRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>BottleService<span class="token punctuation">)</span> <span class="token function">GetBottleById</span><span class="token punctuation">(</span>id <span class="token builtin">uint</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>Bottle<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> s<span class="token punctuation">.</span>repo<span class="token punctuation">.</span><span class="token function">GetById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> hmacKey <span class="token operator">=</span> <span class="token string">"SuPerSeCRetKeY"</span>

<span class="token keyword">type</span> Token <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
	Body TokenBody <span class="token string">&#96;json:"b"&#96;</span>
	Sum  <span class="token builtin">string</span>    <span class="token string">&#96;json:"s,omitempty"&#96;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">type</span> TokenBody <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
	BottleId <span class="token builtin">uint</span>   <span class="token string">&#96;json:"b"&#96;</span>
	OwnerId  <span class="token builtin">string</span> <span class="token string">&#96;json:"o"&#96;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>BottleService<span class="token punctuation">)</span> <span class="token function">SignToken</span><span class="token punctuation">(</span>id <span class="token builtin">uint</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span>
	mac <span class="token operator">:=</span> hmac<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>sha256<span class="token punctuation">.</span>New<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>hmacKey<span class="token punctuation">)</span><span class="token punctuation">)</span>

	buf <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
	rand<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span>
	ownerId <span class="token operator">:=</span> base64<span class="token punctuation">.</span>URLEncoding<span class="token punctuation">.</span><span class="token function">EncodeToString</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span>
	tokenBody <span class="token operator">:=</span> TokenBody<span class="token punctuation">&#123;</span>
		BottleId<span class="token punctuation">:</span> id<span class="token punctuation">,</span>
		OwnerId<span class="token punctuation">:</span>  ownerId<span class="token punctuation">,</span>
	<span class="token punctuation">&#125;</span>
	s<span class="token punctuation">.</span>repo<span class="token punctuation">.</span><span class="token function">SetOwner</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> ownerId<span class="token punctuation">)</span>

	data<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>tokenBody<span class="token punctuation">)</span>
	mac<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
	sum <span class="token operator">:=</span> mac<span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span>
	tokenRaw <span class="token operator">:=</span> Token<span class="token punctuation">&#123;</span>
		Body<span class="token punctuation">:</span> tokenBody<span class="token punctuation">,</span>
		Sum<span class="token punctuation">:</span>  base64<span class="token punctuation">.</span>StdEncoding<span class="token punctuation">.</span><span class="token function">EncodeToString</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">&#125;</span>
	token<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>tokenRaw<span class="token punctuation">)</span>
	<span class="token keyword">return</span> base64<span class="token punctuation">.</span>URLEncoding<span class="token punctuation">.</span><span class="token function">EncodeToString</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>BottleService<span class="token punctuation">)</span> <span class="token function">DecodeToken</span><span class="token punctuation">(</span>token <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>id <span class="token builtin">uint</span><span class="token punctuation">,</span> ok <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	tokenRaw<span class="token punctuation">,</span> err <span class="token operator">:=</span> base64<span class="token punctuation">.</span>URLEncoding<span class="token punctuation">.</span><span class="token function">DecodeString</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">false</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">var</span> tokenBody Token
	err <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>tokenRaw<span class="token punctuation">,</span> <span class="token operator">&amp;</span>tokenBody<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">false</span>
	<span class="token punctuation">&#125;</span>
	bottle<span class="token punctuation">,</span> err <span class="token operator">:=</span> s<span class="token punctuation">.</span>repo<span class="token punctuation">.</span><span class="token function">GetById</span><span class="token punctuation">(</span>tokenBody<span class="token punctuation">.</span>Body<span class="token punctuation">.</span>BottleId<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">false</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">if</span> bottle<span class="token punctuation">.</span>Owner <span class="token operator">!=</span> tokenBody<span class="token punctuation">.</span>Body<span class="token punctuation">.</span>OwnerId <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">false</span>
	<span class="token punctuation">&#125;</span>
	mac <span class="token operator">:=</span> hmac<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>sha256<span class="token punctuation">.</span>New<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>hmacKey<span class="token punctuation">)</span><span class="token punctuation">)</span>
	data<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>tokenBody<span class="token punctuation">.</span>Body<span class="token punctuation">)</span>
	mac<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
	sum <span class="token operator">:=</span> mac<span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> base64<span class="token punctuation">.</span>StdEncoding<span class="token punctuation">.</span><span class="token function">EncodeToString</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span> <span class="token operator">!=</span> tokenBody<span class="token punctuation">.</span>Sum <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">false</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">return</span> tokenBody<span class="token punctuation">.</span>Body<span class="token punctuation">.</span>BottleId<span class="token punctuation">,</span> <span class="token boolean">true</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>BottleService<span class="token punctuation">)</span> <span class="token function">DecodeAndRevokeToken</span><span class="token punctuation">(</span>token <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">,</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	id<span class="token punctuation">,</span> ok <span class="token operator">:=</span> s<span class="token punctuation">.</span><span class="token function">DecodeToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>
	err <span class="token operator">:=</span> s<span class="token punctuation">.</span>repo<span class="token punctuation">.</span><span class="token function">SetOwner</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">false</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">return</span> id<span class="token punctuation">,</span> ok
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>BottleService<span class="token punctuation">)</span> <span class="token function">AttachMessage</span><span class="token punctuation">(</span>id <span class="token builtin">uint</span><span class="token punctuation">,</span> message <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> s<span class="token punctuation">.</span>repo<span class="token punctuation">.</span><span class="token function">AttachMessage</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> message<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>BottleService<span class="token punctuation">)</span> <span class="token function">DeleteBottle</span><span class="token punctuation">(</span>id <span class="token builtin">uint</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> s<span class="token punctuation">.</span>repo<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre> <p data-svelte-h="svelte-1371m4m"><strong>handlers.go</strong></p> <pre class="language-go"><!-- HTML_TAG_START --><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"context"</span>
	<span class="token string">"time"</span>

	<span class="token string">"github.com/gin-gonic/gin"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> BottleHandler <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
	srv <span class="token operator">*</span>BottleService
<span class="token punctuation">&#125;</span>

<span class="token keyword">type</span> BottleDto <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
	Token       <span class="token builtin">string</span>   <span class="token string">&#96;json:"token"&#96;</span>
	Content     <span class="token builtin">string</span>   <span class="token string">&#96;json:"content"&#96;</span>
	Attachments <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token string">&#96;json:"attachments"&#96;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">type</span> CreateBottleReq <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
	Content <span class="token builtin">string</span> <span class="token string">&#96;json:"content"&#96;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">type</span> AttachMessageReq <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
	Content <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// @Summary		Create a bottle</span>
<span class="token comment">// @Description	Create a bottle</span>
<span class="token comment">// @Tags			bottles</span>
<span class="token comment">// @Accept			json</span>
<span class="token comment">// @Produce		json</span>
<span class="token comment">// @Param			bottle	body	CreateBottleReq	true	"The bottle to Create"</span>
<span class="token comment">// @Success		201</span>
<span class="token comment">// @Router			/bottles/ [post]</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>BottleHandler<span class="token punctuation">)</span> <span class="token function">CreateBottle</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">var</span> req CreateBottleReq
	<span class="token keyword">if</span> err <span class="token operator">:=</span> ctx<span class="token punctuation">.</span><span class="token function">ShouldBindJSON</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		ctx<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token string">"error"</span><span class="token punctuation">:</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">&#125;</span>
	entity <span class="token operator">:=</span> <span class="token operator">&amp;</span>Bottle<span class="token punctuation">&#123;</span>Content<span class="token punctuation">:</span> req<span class="token punctuation">.</span>Content<span class="token punctuation">&#125;</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> h<span class="token punctuation">.</span>srv<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		ctx<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token string">"error"</span><span class="token punctuation">:</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">&#125;</span>
	<span class="token comment">// will not respond the bottle to the client</span>
	ctx<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">var</span> timeoutCancelers <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">uint</span><span class="token punctuation">]</span>context<span class="token punctuation">.</span>CancelFunc<span class="token punctuation">)</span>

<span class="token comment">// @Summary		Get a bottle</span>
<span class="token comment">// @Description	Get a bottle</span>
<span class="token comment">// @Tags			bottles</span>
<span class="token comment">// @Accept			json</span>
<span class="token comment">// @Produce		json</span>
<span class="token comment">// @Success		200	&#123;object&#125;	BottleDto</span>
<span class="token comment">// @Router			/bottles/ [get]</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>BottleHandler<span class="token punctuation">)</span> <span class="token function">GetBottle</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	entity<span class="token punctuation">,</span> err <span class="token operator">:=</span> h<span class="token punctuation">.</span>srv<span class="token punctuation">.</span><span class="token function">GetBottle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		ctx<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token string">"error"</span><span class="token punctuation">:</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">&#125;</span>

	<span class="token comment">// set timer to delete the bottle after 30 minutes</span>
	<span class="token comment">// if user have made any decision, should call the corrosponding cancel Function.</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		ctx<span class="token punctuation">,</span> cancel <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">WithCancel</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">defer</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		timeoutCancelers<span class="token punctuation">[</span>entity<span class="token punctuation">.</span>ID<span class="token punctuation">]</span> <span class="token operator">=</span> cancel
		timer <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">NewTimer</span><span class="token punctuation">(</span><span class="token number">30</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Minute<span class="token punctuation">)</span>
		<span class="token operator">&lt;-</span>timer<span class="token punctuation">.</span>C
		<span class="token comment">// not canceled by user, do the default behavior</span>
		<span class="token keyword">if</span> ctx<span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
			<span class="token function">delete</span><span class="token punctuation">(</span>timeoutCancelers<span class="token punctuation">,</span> entity<span class="token punctuation">.</span>ID<span class="token punctuation">)</span>
			h<span class="token punctuation">.</span>srv<span class="token punctuation">.</span><span class="token function">DeleteBottle</span><span class="token punctuation">(</span>entity<span class="token punctuation">.</span>ID<span class="token punctuation">)</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	dto <span class="token operator">:=</span> <span class="token operator">&amp;</span>BottleDto<span class="token punctuation">&#123;</span>
		Token<span class="token punctuation">:</span>       h<span class="token punctuation">.</span>srv<span class="token punctuation">.</span><span class="token function">SignToken</span><span class="token punctuation">(</span>entity<span class="token punctuation">.</span>ID<span class="token punctuation">)</span><span class="token punctuation">,</span>
		Content<span class="token punctuation">:</span>     entity<span class="token punctuation">.</span>Content<span class="token punctuation">,</span>
		Attachments<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>entity<span class="token punctuation">.</span>Attachments<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">for</span> i<span class="token punctuation">,</span> attachment <span class="token operator">:=</span> <span class="token keyword">range</span> entity<span class="token punctuation">.</span>Attachments <span class="token punctuation">&#123;</span>
		dto<span class="token punctuation">.</span>Attachments<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> attachment<span class="token punctuation">.</span>Content
	<span class="token punctuation">&#125;</span>
	ctx<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> dto<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// @Summary		Get a bottle by a signd token</span>
<span class="token comment">// @Description	Get a bottle by a signd token</span>
<span class="token comment">// @Tags			bottles</span>
<span class="token comment">// @Accept			json</span>
<span class="token comment">// @Produce		json</span>
<span class="token comment">// @Param			token	path		string	true	"The token of the bottle"</span>
<span class="token comment">// @Success		200		&#123;object&#125;	BottleDto</span>
<span class="token comment">// @Router			/bottles/&#123;token&#125; [get]</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>BottleHandler<span class="token punctuation">)</span> <span class="token function">GetBottleByToken</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	token <span class="token operator">:=</span> ctx<span class="token punctuation">.</span><span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span>
	id<span class="token punctuation">,</span> ok <span class="token operator">:=</span> h<span class="token punctuation">.</span>srv<span class="token punctuation">.</span><span class="token function">DecodeToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">&#123;</span>
		ctx<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token string">"error"</span><span class="token punctuation">:</span> <span class="token string">"invalid token"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">&#125;</span>
	entity<span class="token punctuation">,</span> err <span class="token operator">:=</span> h<span class="token punctuation">.</span>srv<span class="token punctuation">.</span><span class="token function">GetBottleById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		ctx<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token string">"error"</span><span class="token punctuation">:</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">&#125;</span>
	dto <span class="token operator">:=</span> <span class="token operator">&amp;</span>BottleDto<span class="token punctuation">&#123;</span>
		Token<span class="token punctuation">:</span>       token<span class="token punctuation">,</span>
		Content<span class="token punctuation">:</span>     entity<span class="token punctuation">.</span>Content<span class="token punctuation">,</span>
		Attachments<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>entity<span class="token punctuation">.</span>Attachments<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">for</span> i<span class="token punctuation">,</span> attachment <span class="token operator">:=</span> <span class="token keyword">range</span> entity<span class="token punctuation">.</span>Attachments <span class="token punctuation">&#123;</span>
		dto<span class="token punctuation">.</span>Attachments<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> attachment<span class="token punctuation">.</span>Content
	<span class="token punctuation">&#125;</span>
	ctx<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> dto<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// @Summary		Keep the bottle</span>
<span class="token comment">// @Description	Keep the bottle the user have got by token</span>
<span class="token comment">// @Tags			bottles</span>
<span class="token comment">// @Accept			json</span>
<span class="token comment">// @Produce		json</span>
<span class="token comment">// @Param			token	path	string	true	"The token of the bottle"</span>
<span class="token comment">// @Success		200</span>
<span class="token comment">// @Router			/bottles/&#123;token&#125; [put]</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>BottleHandler<span class="token punctuation">)</span> <span class="token function">KeepBottle</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	token <span class="token operator">:=</span> ctx<span class="token punctuation">.</span><span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span>
	id<span class="token punctuation">,</span> ok <span class="token operator">:=</span> h<span class="token punctuation">.</span>srv<span class="token punctuation">.</span><span class="token function">DecodeToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">&#123;</span>
		ctx<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token string">"error"</span><span class="token punctuation">:</span> <span class="token string">"you cannot do this"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">if</span> cancel<span class="token punctuation">,</span> ok <span class="token operator">:=</span> timeoutCancelers<span class="token punctuation">[</span><span class="token function">uint</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> ok <span class="token punctuation">&#123;</span>
		<span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
		ctx<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token string">"error"</span><span class="token punctuation">:</span> <span class="token string">"bad request"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">return</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// @Summary		Throw back the bottle</span>
<span class="token comment">// @Description	Throw back bottle the user have got by token</span>
<span class="token comment">// @Tags			bottles</span>
<span class="token comment">// @Accept			json</span>
<span class="token comment">// @Produce		json</span>
<span class="token comment">// @Param			token	path	string	true	"The token of the bottle"</span>
<span class="token comment">// @Success		200</span>
<span class="token comment">// @Router			/bottles/&#123;token&#125; [post]</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>BottleHandler<span class="token punctuation">)</span> <span class="token function">ThrowBackBottle</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	token <span class="token operator">:=</span> ctx<span class="token punctuation">.</span><span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span>

	id<span class="token punctuation">,</span> ok <span class="token operator">:=</span> h<span class="token punctuation">.</span>srv<span class="token punctuation">.</span><span class="token function">DecodeAndRevokeToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">&#123;</span>
		ctx<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token string">"error"</span><span class="token punctuation">:</span> <span class="token string">"invalid token"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">if</span> cancel<span class="token punctuation">,</span> ok <span class="token operator">:=</span> timeoutCancelers<span class="token punctuation">[</span><span class="token function">uint</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> ok <span class="token punctuation">&#123;</span>
		<span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
		ctx<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token string">"error"</span><span class="token punctuation">:</span> <span class="token string">"bad request"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">return</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// @Summary		Attach message to the bottle</span>
<span class="token comment">// @Description	Attach message to the bottle the user have got by token</span>
<span class="token comment">// @Tags			bottles</span>
<span class="token comment">// @Accept			json</span>
<span class="token comment">// @Produce		json</span>
<span class="token comment">// @Param			token		path	string				true	"The token of the bottle"</span>
<span class="token comment">// @param			attachment	body	AttachMessageReq	true	"The message to attach"</span>
<span class="token comment">// @Success		200</span>
<span class="token comment">// @Router			/bottles/&#123;token&#125;/attachments/ [post]</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>BottleHandler<span class="token punctuation">)</span> <span class="token function">AttachMessage</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	token <span class="token operator">:=</span> ctx<span class="token punctuation">.</span><span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span>
	<span class="token keyword">var</span> req AttachMessageReq
	<span class="token keyword">if</span> err <span class="token operator">:=</span> ctx<span class="token punctuation">.</span><span class="token function">ShouldBindJSON</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		ctx<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token string">"error"</span><span class="token punctuation">:</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">&#125;</span>

	id<span class="token punctuation">,</span> ok <span class="token operator">:=</span> h<span class="token punctuation">.</span>srv<span class="token punctuation">.</span><span class="token function">DecodeAndRevokeToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">&#123;</span>
		ctx<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token string">"error"</span><span class="token punctuation">:</span> <span class="token string">"invalid token"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">if</span> cancel<span class="token punctuation">,</span> ok <span class="token operator">:=</span> timeoutCancelers<span class="token punctuation">[</span><span class="token function">uint</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> ok <span class="token punctuation">&#123;</span>
		<span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		h<span class="token punctuation">.</span>srv<span class="token punctuation">.</span><span class="token function">AttachMessage</span><span class="token punctuation">(</span><span class="token function">uint</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>Content<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
		ctx<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token string">"error"</span><span class="token punctuation">:</span> <span class="token string">"bad request"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">return</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">NewBottleHandler</span><span class="token punctuation">(</span>srv <span class="token operator">*</span>BottleService<span class="token punctuation">)</span> <span class="token operator">*</span>BottleHandler <span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>BottleHandler<span class="token punctuation">&#123;</span>
		srv<span class="token punctuation">,</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre> <p data-svelte-h="svelte-185x04m"><strong>main.go</strong></p> <pre class="language-go"><!-- HTML_TAG_START --><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"log"</span>

	<span class="token boolean">_</span> <span class="token string">"git.online.njtech.edu.cn/online/backend_itv_2023_go/docs"</span>
	<span class="token string">"github.com/gin-gonic/gin"</span>
	ginSwagger <span class="token string">"github.com/swaggo/gin-swagger"</span>
	<span class="token string">"gorm.io/driver/sqlite"</span>
	<span class="token string">"gorm.io/gorm"</span>

	swaggerFiles <span class="token string">"github.com/swaggo/files"</span>
<span class="token punctuation">)</span>

<span class="token comment">//	@title			Drifting Bottle Simulating (MARS Studio 2023 interview of backend)</span>
<span class="token comment">//	@version		0.1.0</span>
<span class="token comment">//	@description	This is an implement of the backend of the Drifting Bottle Simulating project, which is a part of the interview of MARS Studio 2023.</span>

<span class="token comment">//	@contact.name	MARS Studio</span>
<span class="token comment">//	@contact.url	https://njtechmars.online/</span>
<span class="token comment">//	@contact.email	mars@njtech.edu.cn</span>

<span class="token comment">//	@license.name	CC BY-NC-SA 4.0</span>
<span class="token comment">//	@license.url	https://creativecommons.org/licenses/by-nc-sa/4.0/</span>

<span class="token comment">// @host		localhost:7000</span>
<span class="token comment">// @BasePath	/api/v1</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>sqlite<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">"drifting_bottle.db"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gorm<span class="token punctuation">.</span>Config<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	repo <span class="token operator">:=</span> <span class="token function">NewBottleRepo</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span>
	service <span class="token operator">:=</span> <span class="token function">NewBottleService</span><span class="token punctuation">(</span>repo<span class="token punctuation">)</span>
	handler <span class="token operator">:=</span> <span class="token function">NewBottleHandler</span><span class="token punctuation">(</span>service<span class="token punctuation">)</span>

	r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/api/swagger/*any"</span><span class="token punctuation">,</span> ginSwagger<span class="token punctuation">.</span><span class="token function">WrapHandler</span><span class="token punctuation">(</span>swaggerFiles<span class="token punctuation">.</span>Handler<span class="token punctuation">)</span><span class="token punctuation">)</span>
	v1 <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">"/api/v1"</span><span class="token punctuation">)</span>
	v1<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/bottles/"</span><span class="token punctuation">,</span> handler<span class="token punctuation">.</span>GetBottle<span class="token punctuation">)</span>
	v1<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">"/bottles/"</span><span class="token punctuation">,</span> handler<span class="token punctuation">.</span>CreateBottle<span class="token punctuation">)</span>
	v1<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/bottles/:token"</span><span class="token punctuation">,</span> handler<span class="token punctuation">.</span>GetBottleByToken<span class="token punctuation">)</span>
	v1<span class="token punctuation">.</span><span class="token function">PUT</span><span class="token punctuation">(</span><span class="token string">"/bottles/:token"</span><span class="token punctuation">,</span> handler<span class="token punctuation">.</span>KeepBottle<span class="token punctuation">)</span>
	v1<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">"/bottles/:token"</span><span class="token punctuation">,</span> handler<span class="token punctuation">.</span>ThrowBackBottle<span class="token punctuation">)</span>
	v1<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">"/bottles/:token/attachments/"</span><span class="token punctuation">,</span> handler<span class="token punctuation">.</span>AttachMessage<span class="token punctuation">)</span>

	r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">":7000"</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre> <h2 id="2-运行" data-svelte-h="svelte-13eid8c"><a href="#2-运行">2. 运行</a></h2> <pre class="language-sh"><!-- HTML_TAG_START --><code class="language-sh"><span class="token comment"># 使用 swaggo 生成 openapi 文档</span>
go <span class="token function">install</span> github.com/swaggo/swag/cmd/swag@latest
swag init
go run <span class="token builtin class-name">.</span></code><!-- HTML_TAG_END --></pre></div> <div class="w-full flex flex-col md:flex-row justify-between gap-5 svelte-45li5a"><a href="/blog/join-mars" class="footer-link svelte-45li5a"><span class="svelte-45li5a" data-svelte-h="svelte-bymg4v">上一篇</span> <span class="text-green-600 svelte-45li5a">« 【长期有效】欢迎加入Mars工作室</span></a> <a href="/blog/mars-2023-frontend-interview" class="footer-link items-end text-end svelte-45li5a"><span class="svelte-45li5a" data-svelte-h="svelte-p30zrq">下一篇</span> <span class="text-green-600 svelte-45li5a">Mars工作室2023前端面试题 »</span></a></div></div> <div class="sidebar svelte-1k03ii3"><div class="tags svelte-1k03ii3"><div class="flex flex-row items-center gap-1 svelte-1k03ii3"><div class="w-4 h-4 svelte-1k03ii3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svelte-c8tyih"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"></path></svg></div> <div class="text-lg svelte-1k03ii3" data-svelte-h="svelte-8od3gz">标签</div></div> <div class="flex flex-row flex-wrap gap-2 text-sm svelte-1k03ii3"><span class="py-1 px-2 rounded-2xl text-green-600 bg-green-600/20 svelte-1k03ii3">#面试题</span><span class="py-1 px-2 rounded-2xl text-green-600 bg-green-600/20 svelte-1k03ii3">#后端</span></div></div> <div class="toc-container hidden svelte-1k03ii3"><div class="flex flex-row items-center gap-0.5 svelte-1k03ii3"><div class="w-4 h-4 svelte-1k03ii3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="svelte-c8tyih"><path d="M12.83 352h262.34A12.82 12.82 0 0 0 288 339.17v-38.34A12.82 12.82 0 0 0 275.17 288H12.83A12.82 12.82 0 0 0 0 300.83v38.34A12.82 12.82 0 0 0 12.83 352zm0-256h262.34A12.82 12.82 0 0 0 288 83.17V44.83A12.82 12.82 0 0 0 275.17 32H12.83A12.82 12.82 0 0 0 0 44.83v38.34A12.82 12.82 0 0 0 12.83 96zM432 160H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0 256H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z"></path></svg></div> <div class="text-lg svelte-1k03ii3" data-svelte-h="svelte-a6wgtj">目录</div></div></div> </div></article>  </main> <footer class="frame svelte-131eek1"><ul class="w-full grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6 svelte-131eek1"><li class="flex flex-col gap-2 svelte-131eek1"><h1 class="font-semibold svelte-131eek1">资源</h1> <ul class="flex flex-col gap-1 svelte-131eek1"> <li class="svelte-131eek1"><a href="/rss.xml" class="svelte-131eek1">RSS订阅</a> </li> <li class="svelte-131eek1"><a href="https://github.com/njtech-mars/njtech-mars.github.io" target="_blank" class="svelte-131eek1"><div class="svelte-131eek1">本站仓库</div> <div class="w-3 svelte-131eek1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svelte-c8tyih"><path d="M503.691 189.836L327.687 37.851C312.281 24.546 288 35.347 288 56.015v80.053C127.371 137.907 0 170.1 0 322.326c0 61.441 39.581 122.309 83.333 154.132 13.653 9.931 33.111-2.533 28.077-18.631C66.066 312.814 132.917 274.316 288 272.085V360c0 20.7 24.3 31.453 39.687 18.164l176.004-152c11.071-9.562 11.086-26.753 0-36.328z"></path></svg></div> </a> </li></ul> </li><li class="flex flex-col gap-2 svelte-131eek1"><h1 class="font-semibold svelte-131eek1">友链</h1> <ul class="flex flex-col gap-1 svelte-131eek1"> <li class="svelte-131eek1"><a href="https://www.vistalab.top" target="_blank" class="svelte-131eek1"><div class="svelte-131eek1">远景实验室</div> <div class="w-3 svelte-131eek1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svelte-c8tyih"><path d="M503.691 189.836L327.687 37.851C312.281 24.546 288 35.347 288 56.015v80.053C127.371 137.907 0 170.1 0 322.326c0 61.441 39.581 122.309 83.333 154.132 13.653 9.931 33.111-2.533 28.077-18.631C66.066 312.814 132.917 274.316 288 272.085V360c0 20.7 24.3 31.453 39.687 18.164l176.004-152c11.071-9.562 11.086-26.753 0-36.328z"></path></svg></div> </a> </li> <li class="svelte-131eek1"><a href="https://njtustas.github.io" target="_blank" class="svelte-131eek1"><div class="svelte-131eek1">校大学生科协</div> <div class="w-3 svelte-131eek1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svelte-c8tyih"><path d="M503.691 189.836L327.687 37.851C312.281 24.546 288 35.347 288 56.015v80.053C127.371 137.907 0 170.1 0 322.326c0 61.441 39.581 122.309 83.333 154.132 13.653 9.931 33.111-2.533 28.077-18.631C66.066 312.814 132.917 274.316 288 272.085V360c0 20.7 24.3 31.453 39.687 18.164l176.004-152c11.071-9.562 11.086-26.753 0-36.328z"></path></svg></div> </a> </li></ul> </li><li class="flex flex-col gap-2 svelte-131eek1"><h1 class="font-semibold svelte-131eek1">工作室项目</h1> <ul class="flex flex-col gap-1 svelte-131eek1"> <li class="svelte-131eek1"><a href="https://online.njtech.edu.cn" target="_blank" class="svelte-131eek1"><div class="svelte-131eek1">南工在线</div> <div class="w-3 svelte-131eek1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svelte-c8tyih"><path d="M503.691 189.836L327.687 37.851C312.281 24.546 288 35.347 288 56.015v80.053C127.371 137.907 0 170.1 0 322.326c0 61.441 39.581 122.309 83.333 154.132 13.653 9.931 33.111-2.533 28.077-18.631C66.066 312.814 132.917 274.316 288 272.085V360c0 20.7 24.3 31.453 39.687 18.164l176.004-152c11.071-9.562 11.086-26.753 0-36.328z"></path></svg></div> </a> </li> <li class="svelte-131eek1"><a href="https://mirrors.njtech.edu.cn" target="_blank" class="svelte-131eek1"><div class="svelte-131eek1">南工镜像站</div> <div class="w-3 svelte-131eek1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svelte-c8tyih"><path d="M503.691 189.836L327.687 37.851C312.281 24.546 288 35.347 288 56.015v80.053C127.371 137.907 0 170.1 0 322.326c0 61.441 39.581 122.309 83.333 154.132 13.653 9.931 33.111-2.533 28.077-18.631C66.066 312.814 132.917 274.316 288 272.085V360c0 20.7 24.3 31.453 39.687 18.164l176.004-152c11.071-9.562 11.086-26.753 0-36.328z"></path></svg></div> </a> </li></ul> </li></ul> <p class="copyright svelte-131eek1"><span class="svelte-131eek1">Copyright © 2024 Mars工作室.</span> <a href="https://beian.miit.gov.cn" target="_blank" class="svelte-131eek1" data-svelte-h="svelte-isrgu9">苏ICP备2022032826号</a></p> </footer> <button type="button" aria-label="滑到顶部" class="svelte-xax8mm"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="svelte-c8tyih"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path></svg> </button> 
			
			<script>
				{
					__sveltekit_1lwdj0f = {
						base: new URL("../..", location).pathname.slice(0, -1),
						env: {}
					};

					const element = document.currentScript.parentElement;

					const data = [null,null];

					Promise.all([
						import("../../_app/immutable/entry/start.e4cd780c.js"),
						import("../../_app/immutable/entry/app.cd087bc5.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 5],
							data,
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
  </body>
</html>
